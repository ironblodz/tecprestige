var kmm=kmm||{};(function(s,m,i){hasModified=false;var d=window.konteAddonsMegaMenuConfig||{};if(!d){return false}d.namespace="konte_addons_megamenu";var a=null;var e=function(){var e=this;e.$modal=s("#megamenu-modal");e.templates={};e.state={changed:false};e.itemData={};e.getTemplates=e.getTemplates.bind(e);e.bindEvents=e.bindEvents.bind(e);e.setState=e.setState.bind(e);e.getState=e.getState.bind(e);e.getMegaData=e.getMegaData.bind(e);e.clearMegaData=e.clearMegaData.bind(e);e.openModal=e.openModal.bind(e);e.closeModal=e.closeModal.bind(e);e.confirmClose=e.confirmClose.bind(e);e.render=e.render.bind(e);e.renderPart=e.renderPart.bind(e);e.initSubmenu=e.initSubmenu.bind(e);e.setItemData=e.setItemData.bind(e);e.getFormData=e.getFormData.bind(e);e.getFieldName=e.getFieldName.bind(e);e.getTemplates();e.bindEvents()};e.prototype.getTemplates=function(){var t=this;if(t.templates.length){return t.templates}m.each(d.templates,function(e){t.templates[e]=i.template("megamenu__"+e)});return t.templates};e.prototype.bindEvents=function(){var e=this;s(document).off("."+d.namespace);s(document.body).off("."+d.namespace);e.$modal.off("."+d.namespace);s(document.body).on("click."+d.namespace,".menu-item-settings .item-config-mega",{megaMenu:e},e.onConfigMega).on("click."+d.namespace,".menu-item-settings .item-config-icon",{megaMenu:e},e.onConfigIcon).on("click."+d.namespace,".megamenu-modal__close, .megamenu-modal__backdrop, .megamenu-modal__cancel",{megaMenu:e},e.onClose);e.$modal.on("closed."+d.namespace,{megaMenu:e},e.onClosed).on("opened."+d.namespace,{megaMenu:e},e.onOpened).on("render."+d.namespace,{megaMenu:e},e.onRender).on("rendered."+d.namespace,{megaMenu:e},e.onRendered).on("click."+d.namespace,".megamenu-modal__menu > a",{megaMenu:e},e.onChangePanel).on("click."+d.namespace,"button.megamenu-modal__submenu-settings",{megaMenu:e},e.onOpenSubMenuSettings).on("click."+d.namespace,"button.megamenu-modal__back-settings",{megaMenu:e},e.onGoBackSettings);e.$modal.on("change."+d.namespace,":input",{megaMenu:e},e.onInputsChange).on("change."+d.namespace,"[data-toggle_condition]",{megaMenu:e},e.onChangeToggleCondition).on("change."+d.namespace,'[data-field="mega"]',{megaMenu:e},e.onToggleMegaMenu).on("click."+d.namespace,".megamenu-modal__icon-list-item",{megaMenu:e},e.onSelectIcon).on("click."+d.namespace,".megamenu-modal__icon-selected",{megaMenu:e},e.onClearSelectedIcon).on("input."+d.namespace,".megamenu-modal__icon-search",e.onSearchIcon).on("click."+d.namespace,".megamenu-modal__column-width-handle",{megaMenu:e},e.onResizeMegaColumn).on("click."+d.namespace,".megamenu-modal__submenu-tab",{megaMenu:e},e.onChangeSubmenuTab).on("click."+d.namespace,'.megamenu-modal__submenu-tab button[data-action="edit-tab"]',{megaMenu:e},e.onEditSubmenuTab).on("click."+d.namespace,"button.megamenu-modal__save",{megaMenu:e},e.onSaveChanges);s(document.body).on("megamenu_option_changed."+d.namespace,{megaMenu:e},e.onOptionChanged).on("click."+d.namespace,".megamenu-media__preview",{megaMenu:e},e.onMediaUploaderOpen).on("click."+d.namespace,".megamenu-media__remove",{megaMenu:e},e.onMediaUploaderRemove);s(document).on("menu-item-added."+d.namespace,e.onAddedCustomMenuItems)};e.prototype.openModal=function(){this.$modal.show().addClass("opened");this.$modal.trigger("opened");this.$modal.appendTo(wpNavMenu.menuList.closest("#post-body"));document.body.classList.add("megamenu-modal-open")};e.prototype.closeModal=function(){this.$modal.hide().removeClass("opened");this.$modal.trigger("closed");this.$modal.appendTo(document.body);document.body.classList.remove("megamenu-modal-open")};e.prototype.setState=function(e,t){this.state[e]=t;if("changed"===e){this.$modal.find(".megamenu-modal__save").prop("disabled",!t)}};e.prototype.getState=function(e){if(m.has(this.state,e)){return this.state[e]}return undefined};e.prototype.getMegaData=function(e){var o=this,t=s(e).closest("li.menu-item"),a=t.find(".mega-data"),d=a.data("mega");d.content=a.html();o.itemData={depth:t.menuItemDepth(),megaData:d,data:t.getItemData(),element:t.get(0)};if(0===o.itemData.depth){o.itemGridData=t.find(".mega-data-gridbuilder").data("griddata");var n=t.childMenuItems();o.itemData.children=[];m.each(n,function(e){var t=s(e),a=t.find(".mega-data"),n=t.menuItemDepth(),i=a.data("mega");i.content=a.html();o.itemData.children.push({depth:n,subDepth:n-o.itemData.depth-1,megaData:d,data:t.getItemData(),element:e})})}else{var i=s(o.itemData.element).prevUntil(".menu-item-depth-0");i=i.length?i.last().prev(".menu-item-depth-0"):s(o.itemData.element.previousSibling);var r=i.find(".mega-data").data("mega");o.itemData.in_mega=!!r.mega;o.itemData.in_mega_mode=r.mega_mode;if(1===o.itemData.depth&&o.itemData.in_mega||"tabs"===o.itemData.in_mega_mode){o.tabContentData=t.find(".tab-data-gridbuilder").data("tabdata")}}};e.prototype.clearMegaData=function(){this.itemData={};this.itemGridData={};this.tabContentData={};this.subMenuGridBuilder=null};e.prototype.confirmClose=function(){if(this.getState("changed")&&!confirm(d.l10n.close_confirm)){return false}return true};e.prototype.onClose=function(e){e.preventDefault();if(e.data.megaMenu.confirmClose()){e.data.megaMenu.closeModal()}};e.prototype.onConfigMega=function(e){e.preventDefault();var t=e.data.megaMenu,a="settings";t.getMegaData(e.target);if(!t.itemData.depth){a="mega"}if(1===t.itemData.depth&&t.itemData.in_mega&&"tabs"===t.itemData.in_mega_mode){a="tab-content"}t.setState("rendering",a);t.openModal()};e.prototype.onConfigIcon=function(e){e.preventDefault();var t=e.data.megaMenu;t.getMegaData(e.target);t.setState("rendering","icon");t.openModal()};e.prototype.onInputsChange=function(e){if(e.target.dataset.ignore_state_tracking){return}s(document.body).trigger("megamenu_option_changed")};e.prototype.onOptionChanged=function(e){e.data.megaMenu.setState("changed",true)};e.prototype.onClosed=function(e){var t=e.data.megaMenu;t.clearMegaData();t.setState("changed",false);t.$modal.find(".megamenu-modal__content").html("");t.$modal.removeClass("is-mega");wpNavMenu.targetList=wpNavMenu.menuList;s(".submit-add-to-menu","#side-sortables").prop("disabled",false);s(".submit-add-to-menu","#konte_addons_mega_items").prop("disabled",true);wpNavMenu.menusChanged=t.menusChanged};e.prototype.onOpened=function(e){var t=e.data.megaMenu;if(t.getState("rendering")){t.$modal.trigger("render")}if(t.itemData.megaData.mega||t.itemData.in_mega){t.$modal.addClass("is-mega")}s(".submit-add-to-menu","#side-sortables").prop("disabled",true);t.menusChanged=wpNavMenu.menusChanged};e.prototype.onRender=function(e){var t=e.data.megaMenu.getState("rendering");if(!t){return}e.data.megaMenu.render(t)};e.prototype.render=function(e){this.renderPart("menu",{depth:this.itemData.depth,current:e,in_mega:this.itemData.in_mega?this.itemData.in_mega:false,in_mega_mode:this.itemData.in_mega?this.itemData.in_mega_mode:""});this.renderPart("title",{title:this.$modal.find('.megamenu-modal__menu a[data-panel="'+e+'"]').data("title"),depth:this.itemData.depth,item_title:this.itemData.data["menu-item-title"]});var t=this.$modal.find('.megamenu-modal__content > [data-panel="'+e+'"]');if(!t.length){this.renderPart(e);t=this.$modal.find('.megamenu-modal__content > [data-panel="'+e+'"]')}t.addClass("active").siblings().removeClass("active");this.setState("rendering","");this.$modal.trigger("rendered",[e])};e.prototype.renderPart=function(e,t){var a=this;t=t||a.itemData;switch(e){case"menu":a.$modal.find(".megamenu-modal__frame-menu").html(this.templates.menu(t));break;case"title":a.$modal.find(".megamenu-modal__title").html(a.templates.title(t));break;case"icon":a.$modal.find(".megamenu-modal__content").append(a.templates.icon(t));break;default:if(m.has(a.templates,e)){if(0!==a.itemData.depth&&!a.itemData.in_mega){a.$modal.find(".megamenu-modal__content").append(s('<div class="megamenu-modal__panel" />').attr("data-panel",e).html("<p>"+d.l10n.enable_mega_message+"</p>"))}else{a.$modal.find(".megamenu-modal__content").append(a.templates[e](t))}}break}};e.prototype.onRendered=function(e,t){var a=e.data.megaMenu,n=a.$modal.find('.megamenu-modal__content > [data-panel="'+t+'"]');if(n.data("initialized")){return}n.find('input[data-type="colorpicker"]').wpColorPicker({change:function(){s(document.body).trigger("megamenu_option_changed")},clear:function(){s(document.body).trigger("megamenu_option_changed")}});if("mega"===t){a.initSubmenu()}if("tab-content"===t){var i=n.find(".megamenu-modal__tab-content");if(i.length){a.tabContentBuilder=new o(i,a.tabContentData)}}n.data("initialized","yes")};e.prototype.onChangePanel=function(e){e.preventDefault();e.data.megaMenu.setState("rendering",e.target.dataset.panel);e.data.megaMenu.$modal.trigger("render")};e.prototype.onOpenSubMenuSettings=function(e){e.preventDefault();var t=e.data.megaMenu;if(!t.confirmClose()){return false}var a=s(e.target).closest("li").data("item_id");t.closeModal();s("#menu-item-"+a).find(".menu-item-settings .item-config-mega").trigger("click")};e.prototype.onGoBackSettings=function(e){e.preventDefault();var t=e.data.megaMenu;if(!t.confirmClose()){return false}var a=s(t.itemData.element).prevUntil(".menu-item-depth-0");a=a.length?a.last().prev(".menu-item-depth-0"):s(t.itemData.element.previousSibling);t.closeModal();a.find(".menu-item-settings .item-config-mega").trigger("click")};e.prototype.onMediaUploaderOpen=function(e){e.preventDefault();if(!a){a=i.media({library:{type:"image"}})}var t=s(e.target).closest(".megamenu-media");a.off("select");a.on("select",function(){var e=a.state().get("selection").first().toJSON();t.find(".megamenu-media__preview").html('<img src="'+e.url+'">');t.find('input[data-image_input="id"]').val(e.id).trigger("change");t.find('input[data-image_input="url"]').val(e.url).trigger("change");t.removeClass("megamenu-media--empty")});a.open()};e.prototype.onMediaUploaderRemove=function(e){e.preventDefault();var t=s(e.target).closest(".megamenu-media");t.find(".megamenu-media__preview img").remove();t.find('input[data-image_input="id"]').val("").trigger("change");t.find('input[data-image_input="url"]').val("").trigger("change");t.addClass("megamenu-media--empty")};e.prototype.getFieldName=function(e,t){t=t||this.itemData.data["menu-item-db-id"];e=e.split(".");e="["+e.join("][")+"]";return"menu-item-mega["+t+"]"+e};e.prototype.onChangeToggleCondition=function(e){var t="data-toggle_"+e.currentTarget.dataset.toggle_condition,a=e.currentTarget.value,n=e.data.megaMenu.$modal;if(e.currentTarget.dataset.toggle_scope){n=s(e.currentTarget).closest(e.currentTarget.dataset.toggle_scope)}if("radio"===e.currentTarget.type){a=n.find('input[type="radio"][name="'+e.currentTarget.name+'"]:checked').val()}else if("checkbox"===e.currentTarget.type){a=e.currentTarget.checked?a:""}n.find("["+t+"]").hide().addClass("hidden").filter("["+t+'="'+a+'"]').show().removeClass("hidden")};e.prototype.onToggleMegaMenu=function(e){if(e.currentTarget.checked){e.data.megaMenu.$modal.addClass("is-mega")}else{e.data.megaMenu.$modal.removeClass("is-mega")}};e.prototype.onSelectIcon=function(e){e.preventDefault();var t=s(e.target);t.addClass("active").siblings(".active").removeClass("active");t.closest(".megamenu-modal__icon-picker").find(".megamenu-modal__icon-selected").html('<i class="'+e.target.dataset.icon+'"></i>').siblings('input[type="hidden"]').val(e.target.dataset.icon).trigger("change")};e.prototype.onClearSelectedIcon=function(e){e.preventDefault();s(e.target).closest(".megamenu-modal__icon-selected").html("").siblings('input[type="hidden"]').val("").trigger("change").closest(".megamenu-modal__icon-picker").find(".megamenu-modal__icon-list-item.active").removeClass("active")};e.prototype.onSearchIcon=function(e){var t=e.target.value.toLowerCase(),a=s(e.target).closest(".megamenu-modal__icon-picker").find(".megamenu-modal__icon-list-item");if(!t){a.show()}else{a.hide().filter(function(){return this.dataset.icon.toLowerCase().indexOf(t)>-1}).show()}};e.prototype.onResizeMegaColumn=function(e){e.preventDefault();var t=s(e.target).closest(".megamenu-modal__column-width-handle"),a=t.closest(".megamenu-modal__submenu-column"),n=a.data("width"),i=e.data.megaMenu.getWidthData(n),o;if(!i){return}if("increase"===t.data("action")){o=i.increase?i.increase:i}else{o=i.decrease?i.decrease:i}a.css("width",o.width);a.data("width",o.width);a.find(".megamenu-modal__column-width-label").text(o.label);a.find(".menu-item-depth-0 input.menu-item-width").val(o.width).trigger("change")};e.prototype.getWidthData=function(t){var e=[{width:"12.50%",label:"1/8"},{width:"20.00%",label:"1/5"},{width:"25.00%",label:"1/4"},{width:"33.33%",label:"1/3"},{width:"37.50%",label:"3/8"},{width:"40.00%",label:"2/5"},{width:"50.00%",label:"1/2"},{width:"60.00%",label:"3/5"},{width:"62.50%",label:"5/8"},{width:"66.66%",label:"2/3"},{width:"75.00%",label:"3/4"},{width:"80.00%",label:"4/5"},{width:"87.50%",label:"7/8"},{width:"100.00%",label:"1/1"}];var a=m.findIndex(e,function(e){return e.width===t});if(a==="undefined"){return false}var n={index:a,width:e[a].width,label:e[a].label};if(a>0){n.decrease={index:a-1,width:e[a-1].width,label:e[a-1].label}}if(a<e.length-1){n.increase={index:a+1,width:e[a+1].width,label:e[a+1].label}}return n};e.prototype.initSubmenu=function(){var n=this,e=n.$modal.find(".megamenu-modal__submenu-column");if(e.length){var i="25.00%";if(e.length<=5){i=String((100/e.length).toFixed(2))+"%"}m.each(e,function(e){var t=e.dataset.width;if(!parseInt(t)){t=i}var a=n.getWidthData(t);e.style.width=a.width;e.dataset.width=a.width;s(e).find(".menu-item-depth-0 input.menu-item-width").val(t);s(e).find(".megamenu-modal__column-width-label").text(a.label)})}var t=n.$modal.find(".megamenu-modal__submenu--grid");if(t.length){n.subMenuGridBuilder=new o(t,n.itemGridData)}};e.prototype.onChangeSubmenuTab=function(e){e.preventDefault();var t=s(this);if(t.hasClass("active")){return}t.addClass("active").siblings().removeClass("active")};e.prototype.onEditSubmenuTab=function(e){e.preventDefault();var t=e.data.megaMenu;if(!t.confirmClose()){return false}var a=s(this).data("item_id");t.closeModal();s("#menu-item-"+a).find(".menu-item-settings .item-config-mega").trigger("click")};e.prototype.getFormData=function(){var e=this.$modal.find(".megamenu-modal__content :input");e.filter(":checkbox:not(:checked)").each(function(e,t){var a=s(t);a.data("value",a.val());a.attr("value","").prop("checked",true)});var t=e.serialize();e.filter(':checkbox[value=""]').each(function(e,t){var a=s(t);a.prop("checked",false).attr("value",a.data("value")).removeData("value")});return t};e.prototype.setItemData=function(e,t){var a=s(e).find(".mega-data");if(m.has(t,"content")){a.html(t.content);delete t.content}a.data("mega",t)};e.prototype.onSaveChanges=function(e){e.preventDefault();var n=e.data.megaMenu,i=n.$modal.find(".spinner"),t=n.getFormData();i.addClass("is-active");s.post(ajaxurl,{action:d.namespace+"_save",data:t},function(e){i.removeClass("is-active");if(!e.success){return}var t=e.data["menu-item-mega"];if(m.has(t,n.itemData.data["menu-item-db-id"])){var a=t[n.itemData.data["menu-item-db-id"]];n.setItemData(n.itemData.element,a);if(n.itemData.depth===0){if(a["mega"]){n.itemData.element.setAttribute("data-mega",a["mega_mode"])}else{n.itemData.element.removeAttribute("data-mega")}}}m.each(n.itemData.children,function(e){if(!m.has(t,e.data["menu-item-db-id"])){return}n.setItemData(e.element,t[e.data["menu-item-db-id"]])});n.setState("changed",false);wpNavMenu.menusChanged=n.menusChanged});if(n.subMenuGridBuilder){n.subMenuGridBuilder.saveChanges({action:d.namespace+"_update_grid",menuItemId:n.itemData.data["menu-item-db-id"]});s(n.itemData.element).find(".mega-data-gridbuilder").data("griddata",n.subMenuGridBuilder.data)}if(n.tabContentBuilder){n.tabContentBuilder.saveChanges({action:d.namespace+"_update_tab",menuItemId:n.itemData.data["menu-item-db-id"]});s(n.itemData.element).find(".tab-data-gridbuilder").data("tabdata",n.tabContentBuilder.data)}};e.prototype.onAddedCustomMenuItems=function(e,t){if(!wpNavMenu.targetList.is(wpNavMenu.menuList)){return}t.filter(".menu-item").each(function(){var e=s(this);if(e.hasClass("menu-item-megamenu")){wpNavMenu.removeMenuItem(e)}})};var o=function(e,t){var a=this;a.$ui=e;a.$content=a.$ui.find(".megamenu-modal-grid__inside");a.data={rows:[],columns:[],items:[]};a.templates={row:i.template("megamenu__mega-grid-row"),column:i.template("megamenu__mega-grid-column"),options:i.template("megamenu__mega-grid-options")};a.selectors={row:".megamenu-modal-grid__row",column:".megamenu-modal-grid__column",itemList:".megamenu-modal-grid__items",optionsPopup:".megamenu-modal-grid__options-popup"};a.$ui.off();s(document).off("."+d.namespace);a.render=a.render.bind(a);a.addRow=a.addRow.bind(a);a.removeRow=a.removeRow.bind(a);a.updateRow=a.updateRow.bind(a);a.addColumn=a.addColumn.bind(a);a.removeColumn=a.removeColumn.bind(a);a.updateColumn=a.updateColumn.bind(a);a.getRowFreeWidth=a.getRowFreeWidth.bind(a);a.addItem=a.addItem.bind(a);a.removeItem=a.removeItem.bind(a);a.updateItem=a.updateItem.bind(a);a.sortItems=a.sortItems.bind(a);a.getMenuItemData=a.getMenuItemData.bind(a);a.dataToParams=a.dataToParams.bind(a);a.saveChanges=a.saveChanges.bind(a);a.generateId=a.generateId.bind(a);a.openOptionsModal=a.openOptionsModal.bind(a);a.$ui.on("init",{builder:a},a.onInit);a.$ui.on("click",'.megamenu-modal-grid__actions [data-action="add-row"]',{builder:a},a.onAddRow);a.$ui.on("click",'.megamenu-modal-grid__row-actions [data-action="add-column"]',{builder:a},a.onAddColumn);a.$ui.on("click",'.megamenu-modal-grid__row-actions [data-action="toggle-options"]',{builder:a},a.onToggleRowOptions);a.$ui.on("click",'.megamenu-modal-grid__row-actions [data-action="delete"]',{builder:a},a.onDeleteRow);a.$ui.on("click",'.megamenu-modal-grid__row-actions [data-action="options"]',{builder:a},a.onToggleRowOptionsPopup);a.$ui.on("click",'.megamenu-modal-grid__column-actions [data-action="toggle-options"]',{builder:a},a.onToggleColumnOptions);a.$ui.on("click",'.megamenu-modal-grid__column-actions [data-action="options"]',{builder:a},a.onToggleColumnOptionsPopup);a.$ui.on("click",'.megamenu-modal-grid__column-actions [data-action="delete"]',{builder:a},a.onDeleteColumn);a.$ui.on("click",'.megamenu-modal-grid__column-actions [data-action="reset-width"]',{builder:a},a.onResetColumnWidth);a.$ui.on("click",'.megamenu-modal-grid__column-actions [data-action="resize"]',{builder:a},a.onResizeColumn);a.$ui.on("column_added",{builder:a},a.onColumnAdded);a.$ui.on("column_updated",{builder:a},a.onColumnUpdated);a.$ui.on("column_added column_removed",{builder:a},a.toggleRowEmptyClass);s(document).on("click."+d.namespace,a.selectors.optionsPopup+' [data-action="save-options"]',{builder:a},a.onSaveOptionsPopup).on("click."+d.namespace,a.selectors.optionsPopup+' [data-action="close-options"]',{builder:a},a.onCloseOptionsPopup);a.$ui.on("click",'.megamenu-modal-grid__items-actions [data-action="add-item"]',{builder:a},a.onSelectColumnToAddItem);a.$ui.on("click",a.selectors.column,{builder:a},a.onSelectColumnToAddItem);s(document).on("menu-item-added."+d.namespace,{builder:a},a.onMenuItemAdded).on("menu-removing-item."+d.namespace,{builder:a},a.onMenuItemRemoving);a.$ui.on("change input",a.selectors.itemList+" :input",{builder:a},a.onChangeItemInputs);a.$ui.on("change input",".edit-menu-item-title",{builder:a},a.onChangeItemTitle);a.render(t);a.$ui.trigger("init",[a])};o.prototype.render=function(e){var i=this,t=e.rows||[],a=e.columns||[],n=e.items||[];i.$content.html("");if(m.isEmpty(t)){return}m.each(t,function(e){i.addRow(e)});m.each(a,function(e){i.addColumn(e)});if(m.size(n)){m.each(n,function(e){i.addItem(e)});var o=s('<div class="megamenu-modal__submenu-loader"><span class="spinner is-active"></span></div>');o.appendTo(i.$ui);s.post(ajaxurl,{action:d.namespace+"_get_grid_items",items:n,"menu-settings-column-nonce":s("#menu-settings-column-nonce").val()},function(e){o.remove();s(e).filter(".menu-item").each(function(){var e=s(this),t=e.find(".menu-item-checkbox").data("menu-item-id"),a=m.find(i.data.items,{id:t});if(!a){return}i.modifyMenuItem(e);e.hideAdvancedMenuItemFields();var n=i.$ui.find(i.selectors.column+'[data-id="'+a.col.toString()+'"]');s(i.selectors.itemList,n).append(e)})})}};o.prototype.onInit=function(e){var a=e.data.builder;a.$content.sortable({placeholder:"sortable-placeholder",handle:'span[data-action="sort"]',update:function(e){a.$content.children(a.selectors.row).each(function(e,t){a.updateRow({id:s(t).data("id"),order:e})});a.data.rows=m.sortBy(a.data.rows,"order")}});a.$ui.on("row_added row_updated row_removed column_added column_updated column_removed item_added item_updated item_removed",{builder:a},a.onDataChanged)};o.prototype.onDataChanged=function(e){e.preventDefault();s(document.body).trigger("megamenu_option_changed");e.data.builder.hasChanges=true;wpNavMenu.registerChange()};o.prototype.addRow=function(e,t){e.id=parseInt(e.id);e.order=parseInt(e.order);var a=this.templates.row(e),n=s(a);if("top"===t){this.$content.prepend(n)}else{this.$content.append(n)}this.data.rows.push(e);this.$ui.trigger("row_added",[e])};o.prototype.removeRow=function(t){var a=this,e=m.findWhere(a.data.rows,{id:t});a.$content.find(a.selectors.row+'[data-id="'+t+'"]').remove();a.data.rows=m.without(a.data.rows,e);var n=m.filter(a.data.columns,function(e){return e.row==t});m.each(n,function(e){a.removeColumn(e.id)});a.$ui.trigger("row_removed",[e])};o.prototype.updateRow=function(e){if(!m.isObject(e)||!e.id){return}var t=m.findIndex(this.data.rows,{id:e.id});if(t<0){return}this.data.rows[t]=s.extend(true,{},this.data.rows[t],e);this.$ui.trigger("row_updated",[e])};o.prototype.addColumn=function(e){if(!e.row){return}e.id=parseInt(e.id);e.row=parseInt(e.row);if(m.has(e,"order")){e.order=parseInt(e.order)}var t=this.$content.find(this.selectors.row+'[data-id="'+e.row+'"]'),a=this.templates.column(e),n=s(a);t.find(".megamenu-modal-grid__row-inside").append(n);this.data.columns.push(e);this.$ui.trigger("column_added",[e])};o.prototype.removeColumn=function(e){var t=this,a=m.findWhere(t.data.columns,{id:e});t.$content.find(t.selectors.column+'[data-id="'+e+'"]').remove();t.data.columns=m.without(t.data.columns,a);var n=m.filter(t.data.items,{col:e});m.each(n,function(e){t.removeItem(e.id)});t.$ui.trigger("column_removed",[a])};o.prototype.updateColumn=function(e){if(!m.isObject(e)||!e.id){return}var t=m.findIndex(this.data.columns,{id:e.id});if(t<0){return}this.data.columns[t]=s.extend(true,{},this.data.columns[t],e);this.$ui.trigger("column_updated",[e])};o.prototype.addItem=function(e){if(!e.id&&!e.col){return}e.id=parseInt(e.id);e.col=parseInt(e.col);e.order=parseInt(e.order);if(m.has(e,"is_widget")){e.is_widget="true"===e.is_widget||true===e.is_widget}this.data.items.push(e);this.sortItems();this.$ui.trigger("item_added",[e])};o.prototype.removeItem=function(e){var t=m.findWhere(this.data.items,{id:e});this.data.items=m.without(this.data.items,t);this.sortItems();this.$ui.trigger("item_removed",[t])};o.prototype.updateItem=function(e){if(!m.isObject(e)||!e.id){return}var t=m.findIndex(this.data.items,{id:e.id});this.data.items[t]=s.extend(true,{},this.data.items[t],e);this.$ui.trigger("item_updated",[e])};o.prototype.sortItems=function(){this.data.items=m.chain(this.data.items).sortBy("order").sortBy("col").value()};o.prototype.onAddRow=function(e){e.preventDefault();var t=e.data.builder,a=t.generateId(),n=m.isEmpty(t.data.rows)?0:m.max(t.data.rows,"order").order+1,i=m.extend({id:a,order:n},s(e.currentTarget).data("options"));t.addRow(i);t.$content.find(t.selectors.row+'[data-id="'+a+'"] button[data-action="add-column"]').trigger("click").trigger("click")};o.prototype.onToggleRowOptions=function(e){e.preventDefault();var t=e.data.builder;s(e.currentTarget).siblings(".megamenu-modal-grid__row-options").toggle().closest(t.selectors.row).toggleClass("options-active")};o.prototype.onDeleteRow=function(e){e.preventDefault();var t=e.data.builder,a=s(e.currentTarget).closest(t.selectors.row).data("id");t.removeRow(a)};o.prototype.onToggleRowOptionsPopup=function(e){e.preventDefault();var t=e.data.builder,a=s(e.currentTarget).closest(t.selectors.row).data("id");t.openOptionsModal(a,"row")};o.prototype.onAddColumn=function(e){e.preventDefault();var t=e.data.builder,a=s(e.currentTarget),n=a.closest(t.selectors.row).data("id"),i=m.filter(t.data.columns,{row:n}),o=m.extend({id:t.generateId(),row:n,width:"auto"},a.data("options"));if(i.length<12){var d=t.getRowFreeWidth(n);t.addColumn(o);if(d<8.33){var r=m.last(m.filter(i,function(e){return e.width!=="auto"&&parseFloat(e.width)>8.33}));t.updateColumn({id:r.id,width:Math.max(parseFloat(r.width)-8.33,8.33).toFixed(2)})}}};o.prototype.getRowFreeWidth=function(e){var t=m.filter(this.data.columns,{row:e}),a=100;m.each(t,function(e){if("auto"!==e.width){a-=parseFloat(e.width)}else{a-=8.33}});return a};o.prototype.onToggleColumnOptions=function(e){e.preventDefault();var t=e.data.builder,a=s(e.currentTarget).closest(t.selectors.column);if(a.hasClass("options-active")){a.removeClass("options-active")}else{s(t.selectors.column).removeClass("options-active");a.addClass("options-active")}};o.prototype.onToggleColumnOptionsPopup=function(e){e.preventDefault();var t=e.data.builder,a=s(e.currentTarget).closest(t.selectors.column).data("id");t.openOptionsModal(a,"column");s(t.selectors.column).removeClass("options-active")};o.prototype.onDeleteColumn=function(e){e.preventDefault();var t=e.data.builder,a=s(e.currentTarget).closest(t.selectors.column).data("id");t.removeColumn(a)};o.prototype.onResizeColumn=function(e){e.preventDefault();var t=e.data.builder,a=s(e.currentTarget).closest(t.selectors.column),n=a.data("width"),i=8.33,o=0,d=t.getRowFreeWidth(a.closest(t.selectors.row).data("id"));if("auto"===n){n=parseFloat(a.width()/a.parent().width()*100);d+=i}else{n=parseFloat(n);d+=n}o=n;if("increase"===e.currentTarget.dataset.dir){var r=a.next(),m=r.data("width");if(m!=="auto"&&m>i&&n>=d){d+=m-i;t.updateColumn({id:r.data("id"),width:Math.max(m-i,i).toFixed(2)})}o=n+i;o=Math.min(o,d)}else if("decrease"===e.currentTarget.dataset.dir&&n>i){o=n-i;o=Math.max(o,i)}if(o!==n){t.updateColumn({id:a.data("id"),width:parseFloat(o).toFixed(2)})}};o.prototype.onResetColumnWidth=function(e){e.preventDefault();var t=e.data.builder,a=s(e.currentTarget).closest(t.selectors.column).removeClass("options-active").data("id");t.updateColumn({id:a,width:"auto"})};o.prototype.toggleRowEmptyClass=function(e,t){var a=e.data.builder,n=a.$content.find(a.selectors.row+'[data-id="'+t.row+'"]');if(!n.length){return}if(n.find(".megamenu-modal-grid__row-inside").children().length){n.removeClass("is-empty")}else{n.addClass("is-empty")}};o.prototype.onColumnAdded=function(e,a){var r=e.data.builder,t=r.$content.find(r.selectors.column+'[data-id="'+a.id+'"]'),m=t.parent().width()/12;t.resizable({containment:"parent",handles:"e",minWidth:m,start:function(e,t){var a=t.element.siblings(r.selectors.column),n=t.element.next(),i=t.element.parent().width(),o=i;a.each(function(e,t){if("auto"!==t.dataset.width){o-=s(t).outerWidth()}else{o-=m}});if(n.length&&n.data("width")!=="auto"&&n.outerWidth()>m){o+=n.outerWidth()-m}t.originalElement.resizable("option","maxWidth",o);t.originalElement.data("width","manual").attr("data-width","manual")},stop:function(e,t){var a=(t.size.width/t.element.parent().width()*100).toFixed(2);r.updateColumn({id:t.element.data("id"),width:a})},resize:function(e,t){var a=t.element.parent().width(),n=(t.size.width/a*100).toFixed(2);r.updateColumn({id:t.element.data("id"),width:n});var i=t.element.next(),o=i.outerWidth();if(i.length&&i.data("width")!=="auto"&&o>m){var d=t.size.width-t.originalElement.resizable("option","maxWidth")+o-m;if(d>0){r.updateColumn({id:i.data("id"),width:((o-d)/a*100).toFixed(2)})}}}});t.find(r.selectors.itemList).sortable({placeholder:"sortable-placeholder",handle:".menu-item-handle",connectWith:r.selectors.itemList,update:function(e,t){t.item.closest(r.selectors.itemList).children("li").each(function(e,t){r.updateItem({id:s(t).find("input.menu-item-checkbox").data("menu-item-id"),col:a.id,order:e})});r.sortItems()},remove:function(e){s(e.target).closest(r.selectors.itemList).children("li").each(function(e,t){r.updateItem({id:s(t).find("input.menu-item-checkbox").data("menu-item-id"),order:e})});r.sortItems()}})};o.prototype.onColumnUpdated=function(e,t){var a=e.data.builder;if(m.has(t,"width")){var n=a.$content.find(a.selectors.column+'[data-id="'+t.id+'"]');n.data("width",t.width).attr("data-width",t.width).css("width","auto"===t.width?"":t.width+"%").find(".megamenu-modal-grid__column-width-label").text("auto"===t.width?d.l10n.width_auto:parseFloat(t.width).toFixed(1)+"%");if(n.width()<280){n.addClass("column-small-width")}else{n.removeClass("column-small-width")}}};o.prototype.onSelectColumnToAddItem=function(e){var t=e.data.builder;var a=s(e.currentTarget).closest(t.selectors.column);if(e.currentTarget.tagName.toLowerCase()==="button"){s("#side-sortables").addClass("highlighted");setTimeout(function(){s("#side-sortables").removeClass("highlighted")},1e3)}if(a.hasClass("selected-to-add")){return}t.$ui.find(t.selectors.column+".selected-to-add").removeClass("selected-to-add");a.addClass("selected-to-add");wpNavMenu.targetList=a.find(t.selectors.itemList);s(".submit-add-to-menu","#side-sortables").prop("disabled",false)};o.prototype.onMenuItemAdded=function(e,t){var i=e.data.builder;if(!wpNavMenu.targetList.is(i.selectors.itemList)){return}if(!i.$ui.has(t)){return}var o=t.closest(i.selectors.column).data("id"),a=m.filter(i.data.items,{col:o}),d=m.isEmpty(a)?0:m.max(a,"order").order+1;t.filter(".menu-item").each(function(e,t){var a=s(t);i.modifyMenuItem(a);var n=m.extend({col:o,order:d+e},i.getMenuItemData(t));i.addItem(n)})};o.prototype.modifyMenuItem=function(e){var n=e.find(".menu-item-checkbox").data("menu-item-id");e.find(".field-mega-options, .field-move").remove();if(!e.hasClass("menu-item-megamenu")){var i=["menu-item-db-id","menu-item-object-id","menu-item-object","menu-item-parent-id","menu-item-position","menu-item-type","menu-item-title","menu-item-url","menu-item-description","menu-item-attr-title","menu-item-target","menu-item-classes","menu-item-xfn"];e.find(":input").each(function(){var e,t,a=i.length;while(a--){e=i[a]+"["+n+"]";t=i[a].replace("menu-item-","").replace("-","_");t="db_id"===t?"id":t;if(this.name&&e==this.name){this.removeAttribute("name");this.setAttribute("data-name",t)}}})}e.attr("data-id",n)};o.prototype.onMenuItemRemoving=function(e,t){var a=e.data.builder;if(!wpNavMenu.targetList.is(a.selectors.itemList)){return}if(!a.$ui.has(t)){return}a.removeItem(t.data("id"))};o.prototype.getMenuItemData=function(e){var t=s(e),a={is_widget:false};t.find(":input").each(function(){if(!this.dataset.name){return}a=s.extend(true,{},a,r(this))});if(t.hasClass("menu-item-megamenu")){a.is_widget=true;a.object=a.type;a.type="custom"}return a};o.prototype.onChangeItemInputs=function(e){var t=e.data.builder,a=s(e.currentTarget).closest(".menu-item"),n=s.extend(true,{id:a.data("id")},r(e.currentTarget));t.updateItem(n)};o.prototype.onChangeItemTitle=function(e){var t=s(e.currentTarget),a=t.closest(".menu-item").find(".menu-item-title"),n=t.val();if(n){a.text(n).removeClass("no-title")}else{a.text(i.i18n._x("(no label)","missing menu item navigation label")).addClass("no-title")}};o.prototype.dataToParams=function(){return{rows:m.extend({},this.data.rows),columns:m.extend({},this.data.columns),items:m.extend({},this.data.items)}};o.prototype.saveChanges=function(e){var t=this;if(!t.hasChanges){return}s.post(ajaxurl,{action:e.action,data:t.dataToParams(),id:e.menuItemId},function(e){if(!e.success){alert(e.message);return}t.hasChanges=false})};o.prototype.generateId=function(){if(m.isEmpty(this.data.rows)){return m.uniqueId()}var e=parseInt(m.max(this.data.rows,"id").id),t=m.isEmpty(this.data.columns)?0:parseInt(m.max(this.data.columns,"id").id);e=Math.max(e,t)+1;return e};o.prototype.openOptionsModal=function(e,t){var a=null;if("row"===t){a=m.find(this.data.rows,{id:e})}else if("column"===t){a=m.find(this.data.columns,{id:e})}if(!a){return}var n=s(this.templates.options(a));n.find('input[data-type="colorpicker"]').wpColorPicker();n.data("id",e).data("type",t).addClass("open").appendTo(document.body)};o.prototype.onCloseOptionsPopup=function(e){e.preventDefault();s(e.currentTarget).closest(e.data.builder.selectors.optionsPopup).remove()};o.prototype.onSaveOptionsPopup=function(e){var t=e.data.builder,a=s(e.currentTarget).closest(t.selectors.optionsPopup),n=a.data("type"),i=a.data("id"),o={id:i};if(!n||!i){return}a.find(":input[data-name]").each(function(){o=s.extend(true,{},o,r(this))});if("row"===n){t.updateRow(o)}else if("column"===n){t.updateColumn(o)}a.remove()};s(function(){kmm=new e});function r(e){if(!e.dataset.name){return{}}var t=e.dataset.name.split("."),a="",n=e.value;if(("checkbox"===e.type||"radio"===e.type)&&!e.checked){n=""}t.forEach(function(e){a+='{"'+e+'":'});a+='"'+n+'"';a+="}".repeat(t.length);return JSON.parse(a)}})(jQuery,_,wp);var megaMenuFieldName=function(e,t){e=e.split(".");e="["+e.join("][")+"]";return"menu-item-mega["+t+"]"+e};